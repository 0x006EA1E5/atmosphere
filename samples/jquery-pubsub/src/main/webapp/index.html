<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <script type="text/javascript" src="jquery/jquery-1.3.2.js"></script>
    <script type="text/javascript" src="jquery/jquery.atmosphere.js"></script>
    <script type="text/javascript" src="jquery/jquery.form.js"></script>
     <script type="text/javascript">
        $(document).ready(function() {
            subscribe();
            $('#publishForm').ajaxForm();
        });
    </script>
    <script type="text/javascript">
        function subscribe() {
            // jquery.atmosphere.response
            function callback(response)
            {
                if (response.status == 200) {
                    var data = response.responseBody
                    if (data.length > 0) {
                        $('ul').prepend($('<li></li>').text(data));                      
                    }
                }
            }

            /* set transport to 'streaming' if you want to use http streaming */
            $.atmosphere.subscribe(document.location.toString() + 'pubsub/channel/', callback,
                    $.atmosphere.configuration = {transport: 'long-polling'});
        }
    </script>
</head>
<body>
<p>                                                                                                 

<form id="publishForm" action="/atmosphere-jquery-pubsub/pubsub/channel" method="post">
    Message: <input type="text" name="message"/>
    <input type="submit" value="Submit Comment"/>
</form>
</p>
<p>Waiting for messages...</p>
<ul></ul>
</body>
</html>
